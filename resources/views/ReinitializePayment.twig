<!-- PLUGIN BUTTON -->
{% set paymentId = 0 %}
{% set paidStatus = '' %}

{% if services.template.isCurrentTemplate('tpl.my-account') %}
    {% set properties = order.properties %}

    {% for property in properties %}
        {% if property.typeId == 3 %}
            {% set paymentId = property.value %}
        {% endif %}

        {% if property.typeId == 4 %}
            {% set paidStatus = property.value %}
        {% endif %}
    {% endfor %}
    {% if (paymentId == paymentMethodId) and (paidStatus != 'fullyPaid') %}
        {% set display = "block" %}
    {% else %}
        {% set display = "none" %}
    {% endif %}

    <button id="reinitPrePayment-{{order.order.id}}" class="btn btn-primary btn-block" onClick="loadPrePaymentModal()" data-toggle="modal" data-target="#prePaymentModal" :disabled="" style="display: {{ display }}; margin-top: 0.5rem">
        {{ trans("PrePayment::PaymentMethod.reinitPaymentButton") }}
    </button>

{% elseif services.template.isCurrentTemplate('tpl.confirmation') %}
    {% set properties = order.properties %}

    {% for property in properties %}
        {% if property.typeId == 3 %}
            {% set paymentId = property.value %}
        {% endif %}

        {% if property.typeId == 4 %}
            {% set paidStatus = property.value %}
        {% endif %}
    {% endfor %}
    {% if (paymentId == paymentMethodId) and (paidStatus != 'fullyPaid') %}
        {% include "PrePayment::BankDetails" %}
    {% endif %}

{% endif %}